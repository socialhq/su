
function MessagesSystem(){this.container="messagesSystem";this.currID=-1;};MessagesSystem.prototype.getModel=function(type,msg,id){var code='<div id="alert'+id+'" class="alert '+type+'-alert"><p>'+msg+'</p></div>';return code;};MessagesSystem.prototype.show=function(type,msg,time){this.currID++;$("#"+this.container).append(this.getModel(type,msg,this.currID));$("#alert"+this.currID).animate({opacity:0},0);$("#alert"+(this.currID-1)).stop(true,true).animate({opacity:1},0);$("#alert"+this.currID).animate({opacity:1},500);var msgId=this.currID;if(time){var o=this;setTimeout(function(){o.hide(msgId);},time);}
$("#"+this.container).trigger('changed');return this.currID;};MessagesSystem.prototype.change=function(id,msg){$("#alert"+id).html("<p>"+msg+"</p>");$("#alert"+id).fadeIn("slow");$("#"+this.container).trigger('changed');};MessagesSystem.prototype.hide=function(id){$("#alert"+id).fadeOut("slow");if($("#"+this.container).html()=="")
$("#"+this.container).css("margin-bottom","0");$("#"+this.container).trigger('changed');};var messagesSystem=new MessagesSystem();function injectVariable(string,arr){for(var i=0;i<arr.length;i++){string=string.replace("%s",arr[i]);}
return string;}
function getLanguageArray(){var temp=new Array();for(x in lang)
{var n=temp.length;temp[n]=new Array(x,lang[x]);}
return temp;}
function removeQuotes(str){return str.replace(/"/g,'').replace(/'/g,"");}
function secondsToTime(seconds){var minutes=Math.floor(seconds/60);var seconds=seconds-(minutes*60);if(seconds<10)seconds="0"+seconds;if(minutes<10)minutes="0"+minutes;return minutes+":"+seconds;}
$.extend({getUrlVars:function(){var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf('?')+1).split('#');for(var i=0;i<hashes.length;i++)
{hash=hashes[i].split('=');vars.push(hash[0]);vars[hash[0]]=hash[1];}
return vars;},getUrlVar:function(name){return $.getUrlVars()[name];}});if(typeof deconcept=="undefined"){var deconcept=new Object();}
if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}
if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}
deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a)
{if(!document.getElementById){return;}
this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.propibutes=new Array();if(_1){this.setAttribute("swf",_1);}
if(id){this.setAttribute("id",id);}
if(w){this.setAttribute("width",w);}
if(h){this.setAttribute("height",h);}
if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}
this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}
if(c){this.addParam("bgcolor",c);}
var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}}
deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.propibutes[_e]=_f;},getAttribute:function(_10){return this.propibutes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}
return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}
_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" "
_19+="height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" "
_19+="name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}
var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}
_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}
_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" "
_19+="height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}
var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}
_19+="</object>";}
return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}
if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;return this.getSWFHTML();}else{var _noFlashMessage='<table width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" border="0" cellspacing="0" cellpadding="0">';_noFlashMessage+='<tr><td align="center" valign="middle" bgcolor="#2a2a2a"><br>';_noFlashMessage+='<h4 style="color:#FFF">'+noFlashMessage+'</h4><p><a href="http://www.adobe.com/go/getflashplayer"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" width="112" height="33" border="0" /></a>';_noFlashMessage+='<br></td></tr></table>';return _noFlashMessage
if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}
return false;}}
deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}
try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}
if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}
return _23;}
deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;}
deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}
if(this.major>fv.major){return true;}
if(this.minor<fv.minor){return false;}
if(this.minor>fv.minor){return true;}
if(this.rev<fv.rev){return false;}
return true;}
deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}
if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}
return"";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}
if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}
var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;var noFlashMessage="Transmisja wymaga najnowszej wersji Adobe Flash Player. <br>Kliknij w poniższą ikonkę aby pobrać aktualizację."
var autoReconnectStream=1;function startFlashStream(streamID,token,sender,flashId,flashContainer,isPrv,forcePlay,isOldPhoto,wmode){if(flashId==null)
flashId='video';if(flashContainer==null)
flashContainer='cameraWindow';var prv='';if(isPrv)
prv='&prv=1';var streamerAddress;var divName='video'
var serverAddr;if(sender)
serverAddr=srvO;else
serverAddr=srvE;var isOldPhotoS='';if(isOldPhoto)
isOldPhotoS='&isOldPhoto=1';if(serverAddr!=null){streamerAddress=serverAddr
streamerAddress=streamerAddress.slice(7,streamerAddress.length)
streamerAddress=streamerAddress.replace("/","@")}else
streamerAddress="brak";var fp='';if(forcePlay)
fp='&forcePlay=1';var wm="window";if(wmode)
wm=wmode;var finalLink='flash/suStreamer.swf?cache=1&autoReconnect='+autoReconnectStream+'&id='+streamID+"&swfObjectID="+flashId+'&sender='+sender+'&token='+token+"&address="+streamerAddress+prv+fp+isOldPhotoS;var so=new SWFObject(finalLink,flashId,'100%','100%',"11","#000000");so.addParam("allowScriptAccess","always");so.addParam("wmode",wm);so.addParam("allowFullScreen","true");so.addParam("bgcolor","#FFFFFF");document.getElementById(flashContainer).innerHTML=so.write(divName);};function getServAddr(){return serverAddress;};var myIP;var childServerAddr='';function startChildBug(uid,token,serverAddr){childServerAddr=serverAddr;var finalLink='flash/TransOnline.swf?3&serverAddr='+serverAddr+'&uid='+uid+'&password='+token+'&ip='+myIP+'&time2';var so=new SWFObject(finalLink,'bug',1,1,"11","#000000");so.addParam("allowScriptAccess","always");so.addParam("wmode","window");so.addParam("allowFullScreen","true");document.getElementById('engine').innerHTML=so.write('bug');};function startPhotoMaker(isMain,fromPopup){if(fromPopup)
fromPopup='&fromPopup=1';else
fromPopup='&fromPopup=0';var finalLink='flash/PhotoMaker.swf?isMain='+isMain+fromPopup;var so=new SWFObject(finalLink,'photomaker',600,450,"11","#000000");so.addParam("allowScriptAccess","always");so.addParam("wmode","window");so.addParam("allowFullScreen","true");document.getElementById('photomaker-container').innerHTML=so.write('photomaker');};function makeSound(){document.getElementById('video').makeSound();};var S_LOGIN=0;var S_START_TRANSMISSION=1;var S_JOIN_TRANSMISSION=2;var S_PING=14;var S_TIP=36;var S_CHRISTMAS_CARD=40;var S_T_MESSAGE=4;var S_T_MUTE=5;var S_T_UNMUTE=13;var S_T_STREAM_STATUS=6;var S_T_PHOTO_READY=7;var S_T_SET_DESCRIPTION=8;var S_T_KICK=16;var S_T_BAN=17;var S_T_UNBAN=18;var S_T_LEAVE=19;var S_T_WARN=21;var S_T_SET_PRVSETTINGS=25;var S_T_GET_VIEWERS=33;var S_P_INVITE=22;var S_P_INVITEDECISION=23;var S_P_INVITECANCEL=26;var S_P_JOIN=27;var S_P_MESSAGE=28;var S_P_MODERATE=31;var S_P_STREAM_STATUS=32;var S_Z_SEND=24;var S_Z_SET_SETTINGS=29;var S_Z_WITHDRAW=30;var S_A_MODERATE=9;var S_A_SET_LOG_PRIORITY=10;var S_A_GET_LOG=11;var S_A_MOD_WARN_CLOSE=12;var S_M_SEND=34;var S_M_UPDATE_READED=35;var S_PC_INVITE=37;var S_PC_DECISION=38;var S_PC_CLOSE_ACCEPT_UNIQ=39;var G_TIP_STATUS=169;var G_CHRISTMAS_CARD_STATUS=176;var G_T_CHRISTMAS_CARD=177;var G_T_JOIN_STATUS=102;var G_T_STREAM_ID=103;var G_T_STATISTICS=104;var G_T_MESSAGE=105;var G_T_MODERATED=106;var G_T_MUTE=107;var G_T_MUTED_LIST=108;var G_T_VIEWERS_LIST=109;var G_T_VIEWERS_LIST_ADD=119;var G_T_VIEWERS_LIST_REMOVE=120;var G_T_VIEWERS_LIST_FAILURE=150;var G_T_TERMINATED=110;var G_T_UPDATE_DESCRIPTION=111;var G_T_HOST_STATUS=117;var G_T_SPAM=121;var G_T_BAN_LIST=123;var G_T_KICKED=124;var G_T_BANNED=125;var G_T_LIMIT=126;var G_T_DEL_MES=127;var G_T_GETPRVSETTINGS=135;var G_T_STREAM_STATUS=148;var G_T_TOKENS_TRANSFER=145;var G_T_TOKEN=149;var G_T_TIP=158;var G_T_MSG_PRIVILEGES=159;var G_T_OLD_PHOTO_USED=163;var G_T_FROM_PRV=164;var G_W_JOINED=160;var G_W_TRANS_STARTED=161;var G_W_PRV_INFO=162;var G_P_STARTPRV=128;var G_P_INVITEDECLINED=129;var G_P_INVITECANCEL=130;var G_P_INVITESTATUS=131;var G_P_SETTINGS=132;var G_P_INVITATION=135;var G_P_JOIN_STATUS=136;var G_P_DATA=137;var G_P_USER_STATUS=138;var G_P_MESSAGE=139;var G_P_USER_CLOCK=140;var G_P_TRANS_CLOCK=141;var G_P_TOKENS_TRANSFER=142;var G_P_WILL_BE_MODERATED=147;var G_P_STREAM_READY=157;var G_Z_SENDSTATUS=133;var G_Z_TIPRECEIVED=134;var G_Z_TOKENS_STATUS=143;var G_Z_SETTINGS=144;var G_Z_WITHDRAW_STATUS=146;var G_A_GLOBAL_MUTE=112;var G_A_GLOBAL_KICK=113;var G_A_GLOBAL_BAN=114;var G_A_LOG=115;var G_A_LOG_PRIORITY=116;var G_M_SEND_FAILURE=165;var G_M_NEW_MESSAGE=166;var G_M_UPDATE_TOREAD=167;var G_M_REVERSE_CONV_OWNER=168;var G_M_MOD_WARN=170;var G_M_MOD_WARN_CLOSE=171;var G_PC_INVITATION=172;var G_PC_NEW_STATUS=173;var G_PC_ACCEPT_UNIQ=174;var G_PC_CLOSE_ACCEPT_UNIQ=175;var G_CHILD_SERVER_ADDR=700;var G_STATISTICS=100;function Event(){this.nEvents=0;this.events=new Array();};Event.prototype.addEventListener=function(id,func){this.events[this.nEvents]=new Array();this.events[this.nEvents][0]=id;this.events[this.nEvents][1]=func;this.nEvents++;};Event.prototype.addPackageListener=function(id,packageID,func){this.events[this.nEvents]=new Array();this.events[this.nEvents][0]=id;this.events[this.nEvents][1]=func;this.events[this.nEvents][2]=packageID;this.nEvents++;};Event.prototype.performEvent=function(id,msgObject){var o=this;for(var i=0;i<o.nEvents;i++){if(o.events[i]!=null&&id==o.events[i][0]){if(typeof msgObject!="undefined"&&typeof msgObject.id!="undefined"&&typeof o.events[i][2]!="undefined"){if(o.events[i][2]==msgObject.id)
o.events[i][1](msgObject);}
else if(o.events[i].length<=2)
o.events[i][1](msgObject);}}};function equals(x,y){if(x===y)return true;if(!(x instanceof Object)||!(y instanceof Object))return false;if(x.constructor!==y.constructor)return false;for(var p in x){if(!x.hasOwnProperty(p))continue;if(!y.hasOwnProperty(p))return false;if(x[p]===y[p])continue;if(typeof(x[p])!=="object")return false;if(!Object.equals(x[p],y[p]))return false;}
for(p in y){if(y.hasOwnProperty(p)&&!x.hasOwnProperty(p))return false;}
return true;}
function User(uid,login,sex,adminLevel){if(uid&&login){this.uid=uid;this.login=login;this.adminLevel=adminLevel;this.sex=sex;}else{this.uid=-1;this.login="";this.adminLevel=0;this.sex="";}
this.isLogged=(login)?true:false;this.token='';this.isMuted=0;addPackageListener(packetController.EVT_NEW_PACKAGE,G_A_GLOBAL_MUTE,this.mutedHandler.bind(this));}
User.prototype.mutedHandler=function(p){this.isMuted=(p.msg[0]=="muted");};function isLogged(){return user.isLogged;};function Tokens(){addPackageListener(packetController.EVT_NEW_PACKAGE,G_Z_TOKENS_STATUS,this.tokensStatusHandler.bind(this));};Tokens.prototype.tokensStatusHandler=function(p){var tokens=p.msg[0];if(tokens<0)tokens=0;tokensGUI.setTokens(tokens);};var tokens;$(function(){tokens=new Tokens();});function ListCategories(){this.category='';};ListCategories.prototype.setCategory=function(category){this.category=category;this.updateCookie();};ListCategories.prototype.updateCookie=function(){$.cookie("category",this.category,{expires:7});};var listCategories;$(function(){listCategories=new ListCategories();});function TokensGUI(){};TokensGUI.prototype.setTokens=function(tokens){$("#tokensCountContainer").html(tokens);};var tokensGUI;$(function(){tokensGUI=new TokensGUI();});Function.prototype.bind=function(){if(arguments.length<2&&arguments[0]===undefined){return this;}
var thisObj=this,args=Array.prototype.slice.call(arguments),obj=args.shift();return function(){return thisObj.apply(obj,args.concat(Array.prototype.slice.call(arguments)));};};Function.bind=function(){var args=Array.prototype.slice.call(arguments);return Function.prototype.bind.apply(args.shift(),args);};function PacketController(){this.pingTimer=null;this.bugReady=false;this.nPackagesToSend=0;this.packagesToSend=new Array();this.packetHistory=new Array();this.dontShowDC=true;this.connected=false;this.reconnectSeconds=Math.round((Math.random()*11)+5);this.lastPacketSent=new Date().getTime();this.laststatsRequest=new Date().getTime();this.EVT_CONNECTED=0;this.EVT_DISCONNECTED=1;this.EVT_JOINED_TRANS=2;this.EVT_NEW_PACKAGE=2;this.connectionEvents=new Event();this.connectionEvents.addEventListener(this.EVT_CONNECTED,this.connectedHandler.bind(this));this.connectionEvents.addEventListener(this.EVT_DISCONNECTED,this.disconnectedHandler.bind(this));var o=this;$(function(){setTimeout(function(){if(!o.connected)
o.connectionEvents.performEvent(o.EVT_DISCONNECTED);},15000);});this.connectionEvents.addPackageListener(this.EVT_NEW_PACKAGE,G_A_GLOBAL_KICK,function(){messagesSystem.show('error',lang['global-kicked']);setTimeout(function(){window.location='http://google.com';},3000);});this.connectionEvents.addPackageListener(this.EVT_NEW_PACKAGE,G_A_GLOBAL_BAN,function(p){var days=Math.round((p.msg[0]-(new Date().getTime()/1000))/(60*60*24));messagesSystem.show('error',injectVariable(lang['global-banned'],[days]));if(user.isLogged)
window.location=siteUrl+'/site/log_out';else
{setTimeout(function(){window.location='http://google.pl';},3000);}});};PacketController.prototype.send=function(id,msg){if(typeof msg=="undefined")
msg='';var rMsg=new Array(msg+'');this.sendArray(id,rMsg);};PacketController.prototype.sendArray=function(id,msg){this.packagesToSend[this.nPackagesToSend]=new Array(id,msg);this.nPackagesToSend++;if(this.bugReady){this.performSend();}};PacketController.prototype.performSend=function(){for(var i=0;i<this.nPackagesToSend;i++){try{document.getElementById('bug').sendPackage(this.packagesToSend[i][0],this.packagesToSend[i][1]);}catch(e){}}
this.lastPacketSent=new Date().getTime();this.nPackagesToSend=0;};PacketController.prototype.startReconnect=function(){var messageID=messagesSystem.show('info',lang['reconnecting']+": "+this.reconnectSeconds+" sec");var obj=this;setInterval(function(){if(obj.reconnectSeconds>0)
obj.reconnectSeconds--;messagesSystem.change(messageID,lang['reconnecting']+": "+obj.reconnectSeconds+" sec");if(obj.reconnectSeconds==0)
window.location.reload(true);},1000);};PacketController.prototype.connectedHandler=function(){if(!this.bugReady){this.bugReady=true;this.performSend();}
this.connected=true;this.pingTimer=setInterval(this.sendPing.bind(this),6000);};PacketController.prototype.sendPing=function(){if(new Date().getTime()-this.lastPacketSent>5000)
this.send(S_PING);};PacketController.prototype.disconnectedHandler=function(){this.connected=false;if(this.pingTimer)
clearInterval(this.pingTimer);if(this.dontShowDC)
return;messagesSystem.show('error',lang['disconnected']);this.startReconnect();};var packetController=new PacketController();function parse(id,msg){var packet={id:id,msg:msg};packetController.connectionEvents.performEvent(packetController.EVT_NEW_PACKAGE,packet);};function traceHistory(){var s="Polaczenie: "+packetController.connected;for(var i=0;i<packetController.packetHistory.length;i++){s+=packetController.packetHistory[i].id+" "+packetController.packetHistory[i].msg;}
alert(s);};function performEvent(id){packetController.connectionEvents.performEvent(id);};function addConnectionEventListener(id,func){packetController.connectionEvents.addEventListener(id,func);}
function addPackageListener(id,packageID,func){packetController.connectionEvents.addPackageListener(id,packageID,func);}
function removeConnectionEventListener(id,func){packetController.connectionEvents.removeEventListener(id,func);}
function removePackageListener(id,packageID,func){packetController.connectionEvents.removePackageListener(id,packageID,func);}
function removeEmptyKeys(arr){var temp=new Array();var i2=0;for(var i=0;i<arr.length;i++){if(arr[i]!=""){temp[i2]=arr[i];i2++;}}
return temp;}
function registerTooltip(){$(".tip_trigger").hover(function(){tip=$(this).find('.tip');tip.show();},function(){tip.hide();}).mousemove(function(e){var mousex=e.pageX+20;var mousey=e.pageY+20;var tipWidth=tip.width();var tipHeight=tip.height();var tipVisX=$(window).width()-(mousex+tipWidth);var tipVisY=$(window).height()-(mousey+tipHeight);if(tipVisX<20){mousex=e.pageX-tipWidth-20;}
if(tipVisY<20){mousey=e.pageY-tipHeight-20;}
tip.css({top:mousey,left:mousex});});}
$(document).ready(function(){registerTooltip();});$.fn.enterKey=function(fnc){return this.each(function(){$(this).keypress(function(ev){var keycode=(ev.keyCode?ev.keyCode:ev.which);if(keycode=='13'){fnc.call(this,ev);}})})};jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version;}
if(browser.chrome){browser.webkit=true;}else if(browser.webkit){browser.safari=true;}
jQuery.browser=browser;(function($)
{$.tiny=$.tiny||{};$.tiny.scrollbar={options:{axis:'y',wheel:40,scroll:true,lockscroll:true,size:'auto',sizethumb:'auto',invertscroll:false,dontUpdateWhileMove:false}};$.fn.tinyscrollbar=function(params)
{var options=$.extend({},$.tiny.scrollbar.options,params);this.each(function()
{$(this).data('tsb',new Scrollbar($(this),options));});return this;};$.fn.tinyscrollbar_update=function(sScroll,force)
{return $(this).data('tsb').update(sScroll,force);};function Scrollbar(root,options)
{var moved=false;var disableAutoUpdate=false;var oSelf=this,oWrapper=root,oViewport={obj:$('.viewport',root)},oContent={obj:$('.overview',root)},oScrollbar={obj:$('.scrollbar',root)},oTrack={obj:$('.track',oScrollbar.obj)},oThumb={obj:$('.thumb',oScrollbar.obj)},sAxis=options.axis==='x',sDirection=sAxis?'left':'top',sSize=sAxis?'Width':'Height',iScroll=0,iPosition={start:0,now:0},iMouse={},touchEvents='ontouchstart'in document.documentElement;function initialize()
{oSelf.update();setEvents();return oSelf;}
this.update=function(sScroll,force)
{oViewport[options.axis]=oViewport.obj[0]['offset'+sSize];oContent[options.axis]=oContent.obj[0]['scroll'+sSize];oContent.ratio=oViewport[options.axis]/oContent[options.axis];oScrollbar.obj.toggleClass('disable',oContent.ratio>=1);oTrack[options.axis]=options.size==='auto'?oViewport[options.axis]:options.size;oThumb[options.axis]=Math.min(oTrack[options.axis],Math.max(0,(options.sizethumb==='auto'?(oTrack[options.axis]*oContent.ratio):options.sizethumb)));oScrollbar.ratio=options.sizethumb==='auto'?(oContent[options.axis]/oTrack[options.axis]):(oContent[options.axis]-oViewport[options.axis])/(oTrack[options.axis]-oThumb[options.axis]);iScroll=(sScroll==='relative'&&oContent.ratio<=1)?Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll)):0;iScroll=(sScroll==='bottom'&&oContent.ratio<=1)?(oContent[options.axis]-oViewport[options.axis]):isNaN(parseInt(sScroll,10))?iScroll:parseInt(sScroll,10);if(options.dontUpdateWhileMove){var oThumbPos=oThumb.obj.position();var percent=(100*oThumbPos.top)/(oTrack.obj.height()-oThumb.obj.height());if(!force&&moved&&(percent<90||disableAutoUpdate))
return;}
if(iScroll>0)
moved=true;setSize();};function setSize()
{var sCssSize=sSize.toLowerCase();oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);iMouse.start=oThumb.obj.offset()[sDirection];oScrollbar.obj.css(sCssSize,oTrack[options.axis]);oTrack.obj.css(sCssSize,oTrack[options.axis]);oThumb.obj.css(sCssSize,oThumb[options.axis]);}
function setEvents()
{if(!touchEvents)
{oThumb.obj.bind('mousedown',start);oTrack.obj.bind('mouseup',drag);}
else
{oViewport.obj[0].ontouchstart=function(event)
{if(1===event.touches.length)
{start(event.touches[0]);event.stopPropagation();}};}
if(options.scroll&&window.addEventListener)
{if(!$.browser.msie||parseInt($.browser.version,10)>8){oWrapper[0].addEventListener('DOMMouseScroll',wheel,false);oWrapper[0].addEventListener('mousewheel',wheel,false);}}
else if(options.scroll)
{oWrapper[0].onmousewheel=wheel;}}
function start(event)
{$("body").addClass("noSelect");disableAutoUpdate=true;var oThumbDir=parseInt(oThumb.obj.css(sDirection),10);iMouse.start=sAxis?event.pageX:event.pageY;iPosition.start=oThumbDir=='auto'?0:oThumbDir;if(!touchEvents)
{$(document).bind('mousemove',drag);$(document).bind('mouseup',end);oThumb.obj.bind('mouseup',end);}
else
{document.ontouchmove=function(event)
{event.preventDefault();drag(event.touches[0]);};document.ontouchend=end;}}
function wheel(event)
{if(oContent.ratio<1)
{var oEvent=event||window.event,iDelta=oEvent.wheelDelta?oEvent.wheelDelta/120:-oEvent.detail/3;iScroll-=iDelta*options.wheel;iScroll=Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll));var oThumbPos=oThumb.obj.position();oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);if(options.lockscroll||(iScroll!==(oContent[options.axis]-oViewport[options.axis])&&iScroll!==0))
{oEvent=$.event.fix(oEvent);oEvent.preventDefault();}}}
function drag(event)
{if(oContent.ratio<1)
{if(options.invertscroll&&touchEvents)
{iPosition.now=Math.min((oTrack[options.axis]-oThumb[options.axis]),Math.max(0,(iPosition.start+(iMouse.start-(sAxis?event.pageX:event.pageY)))));}
else
{iPosition.now=Math.min((oTrack[options.axis]-oThumb[options.axis]),Math.max(0,(iPosition.start+((sAxis?event.pageX:event.pageY)-iMouse.start))));}
iScroll=iPosition.now*oScrollbar.ratio;oContent.obj.css(sDirection,-iScroll);oThumb.obj.css(sDirection,iPosition.now);}}
function end()
{disableAutoUpdate=false;$("body").removeClass("noSelect");$(document).unbind('mousemove',drag);$(document).unbind('mouseup',end);oThumb.obj.unbind('mouseup',end);document.ontouchmove=document.ontouchend=null;}
return initialize();}}(jQuery));function MessagesInformer(){this.currentCount=0;addPackageListener(packetController.EVT_NEW_PACKAGE,G_M_UPDATE_TOREAD,this.updateMessagesInformer.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_M_NEW_MESSAGE,this.newMessageHandler.bind(this));};MessagesInformer.prototype.newMessageHandler=function(p){if(p.msg[6]==user.login)
return;var date=new Date();if(!$.cookie("newMessageSound")||$.cookie("newMessageSound")<date.getTime()-(1000*2)){$.cookie("newMessageSound",date.getTime(),{expires:1});document.getElementById("bug").playNewMessageSound();}
messagesInformerGUI.newMessage(p.msg[0],p.msg[6],p.msg[4]);};MessagesInformer.prototype.updateMessagesInformer=function(p){this.currentCount=Number(p.msg[0]);messagesInformerGUI.setCurrentCount();if(this.currentCount!=0)
cardInformer.showInfo('messagesCount','('+this.currentCount+')',true);else
cardInformer.removeInfo('messagesCount');};var messagesInformer;$(function(){messagesInformer=new MessagesInformer();});function MessagesInformerGUI(){this.timer=null;};MessagesInformerGUI.prototype.newMessage=function(conversationID,username,message){var msg;var tokens;if(message.indexOf("[tip]")==-1&&message.indexOf("[card]")==-1){msg='<span>'+username+':</span> '+message;}else if(message.indexOf("[card]")!=-1){var data=msg.replace('[card]','').split(';');tokens=data[0];msg='<span class="tip-color">'+injectVariable(lang['card-info'],[username,tokens])+'</span>';}else{tokens=message.replace('[tip]','');msg='<span class="tip-color">'+injectVariable(lang['tip-info2'],[tokens,username])+'</span>';}
if(msg.length>55)
msg=msg.substr(0,55)+"...";msg='<a href="'+siteUrl+'/site/messages#conversation='+conversationID+'" target="_blank">'+msg+'</a>';if(this.timer!=null)
clearTimeout(this.timer);$('#message-cloud').html(msg).show();this.timer=setTimeout(function(){$('#message-cloud').hide();},10000);};MessagesInformerGUI.prototype.setCurrentCount=function(){$('#messages-count span').remove();if(messagesInformer.currentCount!=0)
$('#messages-count').html($('#messages-count').html()+" <span>("+messagesInformer.currentCount+")</span>");if($('#inboxNavPos')){if(messagesInformer.currentCount!=0)
$('#inboxNavPos span').html("("+messagesInformer.currentCount+")");else
$('#inboxNavPos span').html("");}};var messagesInformerGUI;$(function(){messagesInformerGUI=new MessagesInformerGUI();});function CardInfo(infoID,msg,onlyIfBlur){this.infoID=infoID;this.msg=msg;this.onlyIfBlur=onlyIfBlur;}
function CardInformer(){this.baseTitle=document.title;this.informations=new Array();this.isWindowFocused=true;jQuery(window).bind("focus",this.focusEvent.bind(this)).bind("blur",this.blurEvent.bind(this));};CardInformer.prototype.focusEvent=function(){if(this.isWindowFocused)return;this.isWindowFocused=true;setTimeout(function(){cardInformer.render();},500);};CardInformer.prototype.blurEvent=function(){if(!this.isWindowFocused)return;this.isWindowFocused=false;this.render();};CardInformer.prototype.removeInfo=function(id){var index=-1;for(var i=0;i<this.informations.length;i++){if(this.informations[i].infoID==id){index=i;break;}}
if(index!=-1)
this.informations.splice(index,1);this.render();};CardInformer.prototype.showInfo=function(id,msg,onlyIfBlur){if(!onlyIfBlur)
onlyIfBlur=false;var info=this.getInfo(id);if(info!=null){info.msg=msg;info.onlyIfBlur=onlyIfBlur;}else{this.informations[this.informations.length]=new CardInfo(id,msg,onlyIfBlur);}
this.render();};CardInformer.prototype.render=function(){var str='';for(var i=0;i<this.informations.length;i++){if(!this.informations[i].onlyIfBlur||(this.informations[i].onlyIfBlur&&!this.isWindowFocused))
str+=this.informations[i].msg+' ';}
document.title=str+this.baseTitle;};CardInformer.prototype.getInfo=function(id){for(var i=0;i<this.informations.length;i++){if(this.informations[i].infoID==id)
return this.informations[i];}
return null;};var cardInformer;$(function(){cardInformer=new CardInformer();});function StatsUpdater(){this.timeInterval=180;};StatsUpdater.prototype.start=function(){var o=this;setInterval(function(){o.getStats();},o.timeInterval*1000);};StatsUpdater.prototype.getStats=function(){$.getJSON(siteUrl+'/site/trans_list/get_stats',function(json){$('#trans-num').html(json.transmissions);$('#viewers-num').html(json.connections);});};var statsUpdater;$(function(){statsUpdater=new StatsUpdater();});function OfflineTip(){this.sendToUID=-1;addPackageListener(packetController.EVT_NEW_PACKAGE,G_TIP_STATUS,this.statusHandler.bind(this));};OfflineTip.prototype.sendTip=function(tokens){packetController.sendArray(S_TIP,[this.sendToUID,tokens]);};OfflineTip.prototype.statusHandler=function(p){offlineTipGUI.renderStatus(p.msg[0]);};var offlineTip;$(function(){offlineTip=new OfflineTip();});function OfflineTipGUI(){};OfflineTipGUI.prototype.sendTip=function(){if(offlineTip.sendToUID!=-1){if(user.isLogged){if($('#offline-tip').val()>=10){offlineTip.sendTip($('#offline-tip').val());}else
this.renderStatus('min');}else
this.renderStatus('login');}else
alert("Błąd wysyłania napiwków - poinformuj administrację serwisu");};OfflineTipGUI.prototype.renderStatus=function(status){var divClass='';var msg='';switch(status){case'login':divClass='red-info';msg=lang['login-first'];break;case'min':divClass='red-info';msg=lang['tip-min'];break;case'yourSelf':divClass='red-info';msg=lang['tip-yourself'];break;case'noUser':divClass='red-info';msg=lang['fav-usernotfound'];break;case'cantHost':divClass='red-info';msg=lang['tip-cant-be-host'];break;case'tooLittleTokens':divClass='red-info';msg=lang['tip-little-tokens'];break;case'success':divClass='green-info';msg=lang['tip-succ'];$('#offline-tip-list').prepend('<li><span class="username">'+user.login+'</span><span class="tokens">+'+$('#offline-tip').val()+'</span></li>');setTimeout(function(){$('.offline-tip .info').hide('slow');if($('.leave-comment .redInfo').length!=0){location.reload(true);}},3000);break;default:break;}
$('.offline-tip .info').removeClass().addClass('info').addClass(divClass);$('.offline-tip .info').html(msg);$('.offline-tip .info').show('slow');};var offlineTipGUI;$(function(){offlineTipGUI=new OfflineTipGUI();});function PrvCall(){this.currentUid=-1;this.timer=null;this.timerStartTime=null;if(user.isLogged){addPackageListener(packetController.EVT_NEW_PACKAGE,G_PC_NEW_STATUS,this.status.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_PC_INVITATION,this.invitation.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_P_STARTPRV,this.invitationAcceptedHandler.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_PC_ACCEPT_UNIQ,this.showAcceptInvitation.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_PC_CLOSE_ACCEPT_UNIQ,this.closeAcceptInvitation.bind(this));}};PrvCall.prototype.getTemplates=function(uid){this.currentUid=uid;$.getJSON(siteUrl+'/site/profile/get_prv_templates/'+uid,function(data){prvCallGUI.renderTemplates(data);});};PrvCall.prototype.invite=function(templateId,tokens){packetController.sendArray(S_PC_INVITE,new Array(this.currentUid,templateId,tokens));};PrvCall.prototype.accept=function(){prvCallGUI.hideRightPopup();packetController.sendArray(S_PC_DECISION,new Array('accept'));};PrvCall.prototype.decline=function(){prvCallGUI.hideRightPopup();packetController.sendArray(S_PC_DECISION,new Array('decline'));};PrvCall.prototype.invitation=function(p){prvCallGUI.showInvitation(p.msg[0]==user.uid,p.msg[0],p.msg[1],p.msg[2],p.msg[3],p.msg[4],p.msg[5],p.msg[6],p.msg[7]);if(p.msg[0]==user.uid){if(this.timer!=null)
clearInterval(this.timer);var o=this;this.timerStartTime=new Date();prvCallGUI.updateTimer(this.calculateTime(Number(p.msg[7])));this.timer=setInterval(function(){prvCallGUI.updateTimer(o.calculateTime(Number(p.msg[7])));},1000);}};PrvCall.prototype.calculateTime=function(secondsLeft){var seconds=Math.round((this.timerStartTime.getTime()-new Date().getTime())/1000+secondsLeft);if(seconds<=0){seconds=0;if(this.timer!=null)
clearInterval(this.timer);}
return secondsToTime(seconds);};PrvCall.prototype.status=function(p){switch(p.msg[2]){case'accepted':if(p.msg[0]!=user.uid){prvCallGUI.hideBottomPopup();prvCallGUI.hideRightPopup();}
break;case'denied':if(p.msg[0]==user.uid)
prvCallGUI.showBottomPopup('<span class="red">'+lang['upc-denied']+'</span>',15000);else
prvCallGUI.hideRightPopup();break;case'timeUp':if(p.msg[0]==user.uid){setTimeout(function(){prvCallGUI.showBottomPopup('<span class="red">'+lang['upc-timeup']+'</span>',15000);},5000);}else{prvCallGUI.hideRightPopup();}
break;case'tooLittleTokens':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-too-little-tokens'],0,false,true);break;case'noTemplate':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-no-template'],0,false,true);break;case'notEnabled':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-not-enabled'],0,true,false);break;case'noToUser':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-no-user'],0,true,false);break;case'alreadyInvited2':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-already-invited2'],0,false,true);break;case'alreadyInvited':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-already-invited'],0,false,true);break;case'yourSelf':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-yourself'],0,false,true);break;case'success':prvCallGUI.clearAlerts();prvCallGUI.showAlert('success',lang['upc-success-invi'],0,true,false);break;case'error':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-error'],0,false,true);break;case'haveTrans':prvCallGUI.clearAlerts();prvCallGUI.showAlert('error',lang['upc-havetrans'],0,true,false);break;default:break;}};PrvCall.prototype.closeAcceptInvitation=function(p){prvCallGUI.hideRightPopup();};PrvCall.prototype.showAcceptInvitation=function(p){prvCallGUI.showAcceptInvitation(p.msg[0]);};PrvCall.prototype.invitationAcceptedHandler=function(p){window.location=siteUrl+"/prv/"+p.msg[0];};PrvCall.prototype.enterPrv=function(uniq){packetController.sendArray(S_PC_CLOSE_ACCEPT_UNIQ,new Array());window.location=siteUrl+"/prv/"+uniq;};var prvCall;$(function(){prvCall=new PrvCall();});function PrvCallGUI(){this.currentPos='';this.selectedTemplateId=-1;this.selectedTemplateTokens=-1;this.bottomPopupTimer=null;this.bottomPopup='<div class="prv-call-bottom"></div>';this.rightPopup='<div class="prv-call-right"></div>';};PrvCallGUI.prototype.open=function(uid,username,obj,pos){this.currentPos=pos;packetController.dontShowDC=false;this.close();prvCall.getTemplates(uid);if(typeof favorites!="undefined")
favorites.removeRequestTimer();var html='<div id="prv-call-popup" class="popup">';html+='<div class="popup-arrow"></div>';html+='<div class="prv-alerts"></div>';html+='<div class="prv-about">';html+='<strong>'+lang['upc-info-short']+'</strong><br/>';html+=lang['upc-info-short2'];html+='<br/><a class="generic-pink-btn agree" style="margin-top:10px;" href="javascript:void(0)">'+lang['upc-next']+'</a> <a class="gray-btn close-call" style="margin-top:10px;" href="javascript:void(0)">'+lang['close']+'</a>';html+='</div>';html+='<div class="prv-confirm">';html+='<div style="margin-bottom:8px;">'+lang['upc-confirmation-info']+'</div>';html+='<a class="generic-pink-btn confirm" href="javascript:void(0)">'+lang['upc-confirm']+'</a>';html+='<a class="gray-btn cancel" href="javascript:void(0)" style="float:right;">'+lang['upc-cancel']+'</a>';html+='</div>';html+='<div class="prv-content">';html+='<span class="call-title">'+username+'</span>';html+='<div class="scrollbar-replace" id="prv-invitations">';html+='<div style="height: 160px;" class="scrollbar disable"><div style="height: 160px;" class="track"><div style="top: 0px; height: 21px;" class="thumb"><div class="end"></div></div></div></div>';html+='<div class="viewport" style="width:300px;"><div class="overview">';html+=lang['please-wait'];html+='</div></div>';html+='</div>';html+='<a class="gray-btn close-call" href="javascript:void(0)">'+lang['close']+'</a>';html+='<a class="generic-pink-btn invitation" href="javascript:void(0)">'+lang['p-invi-invite']+'</a>';html+='<a class="generic-pink-btn how-it-works" style="margin-left:5px;" href="javascript:void(0)">?</a>';html+='</div>';html+='</div>';$(obj).before(html);$('#prv-invitations').tinyscrollbar({sizethumb:21});if($.cookie('prv-call-informed')&&$.cookie('prv-call-informed')=="true"){$('#prv-call-popup .prv-about').hide();$('#prv-call-popup .prv-content').show();}
$('#prv-call-popup').css('width','310px');if(pos=='bottom'){$('#prv-call-popup').css('top','60px');$('#prv-call-popup .popup-arrow').css('top','-13px').css('background','url(images/popup-arrow2.png)');}else{$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');}
var o=this;$('#prv-call-popup .invitation').click(function(){o.clearAlerts();if(!user.isLogged)
o.showAlert("error",lang['login-first'],10000);else if(typeof $('#prv-call-popup .overview input[name="prv_template"]:checked').val()!="undefined"){o.selectedTemplateId=$('#prv-call-popup .overview input[name="prv_template"]:checked').val();o.selectedTemplateTokens=$('#template'+o.selectedTemplateId+' .tokens').html();$('#prv-call-popup .prv-content').hide();$('#prv-call-popup .prv-confirm').show();if(pos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');}else
o.showAlert("error",lang['upc-temp-not-choosen'],3000);});$('#prv-call-popup .agree').click(function(){$.cookie("prv-call-informed","true",{expires:14});$('#prv-call-popup .prv-about').hide();$('#prv-call-popup .prv-content').show();if(pos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');$('#prv-invitations').tinyscrollbar({sizethumb:21});});$('#prv-call-popup .how-it-works').click(function(){$.cookie("prv-call-informed","",{expires:0});$('#prv-call-popup .prv-about').show();$('#prv-call-popup .prv-content').hide();if(pos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');});$('#prv-call-popup .close-call').click(function(){o.close();});$('#prv-call-popup .cancel').click(function(){o.cancel();});$('#prv-call-popup .confirm').click(function(){prvCall.invite(o.selectedTemplateId,o.selectedTemplateTokens);$('#prv-call-popup .prv-content').hide();$('#prv-call-popup .prv-confirm').hide();o.clearAlerts();o.showAlert("info",lang['please-wait'],60*10*1000);if(pos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');});};PrvCallGUI.prototype.showAlert=function(type,msg,time,attachClose,attachCancel){var o=this;var obj=$('<div class="prv-'+type+'-alert">'+msg+'</div>');$('#prv-call-popup .prv-alerts').append(obj);if(attachClose&&$('#prv-call-popup .prv-alerts .close-call').length==0){$('#prv-call-popup .prv-alerts').append('<a class="gray-btn close-call" style="margin-top:10px;" href="javascript:void(0)">'+lang['close']+'</a>');$('#prv-call-popup .close-call').click(function(){o.close();});}else if(attachCancel&&$('#prv-call-popup .prv-alerts .cancel').length==0){$('#prv-call-popup .prv-alerts').append('<a class="gray-btn cancel" style="margin-top:10px;" href="javascript:void(0)">'+lang['upc-cancel']+'</a>');$('#prv-call-popup .cancel').click(function(){o.cancel();});}else
setTimeout(function(){$(obj).remove();if(o.currentPos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');},time);if(this.currentPos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');};PrvCallGUI.prototype.clearAlerts=function(type,msg,time){$('#prv-call-popup .prv-alerts').html('');if(this.currentPos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');};PrvCallGUI.prototype.renderTemplates=function(data){$('#prv-call-popup .overview').html('');var html='';$(data).each(function(k,v){var checked='';if(data.length==1)
checked='CHECKED';html+='<div class="session-option">';html+='<label id="template'+v.id+'">'
html+='<span class="session-title"><input type="radio" name="prv_template" name="prvSelectedTemplate" value="'+v.id+'" '+checked+'>'+v.description+'</span>';html+='<p class="session-details">';html+='<span class="session-time">'+lang['p-invi-time']+': '+v.time+' min.</span> | <span class="session-price">'+lang['p-invi-price']+': <span class="tokens">'+v.tokens+'</span> żetonów';html+='</span></p>';if(v.type==2)
html+='<p><small>+ '+lang['p-invi-type2']+'</small></p>';html+='</label>';html+='</div>';});if(data.length==0)
html=lang['upc-no-templates'];$('#prv-call-popup .overview').html(html);$('#prv-invitations').tinyscrollbar_update();};PrvCallGUI.prototype.cancel=function(){this.clearAlerts();this.selectedTemplateId=-1;$('#prv-call-popup .prv-content').show();$('#prv-call-popup .prv-confirm').hide();if(this.currentPos=='top')$('#prv-call-popup').css('top','-'+($('#prv-call-popup').height()+30)+'px');};PrvCallGUI.prototype.close=function(){if(typeof favorites!="undefined")
favorites.addRequestTimer();if($('#prv-call-popup').length!=0){$('#prv-call-popup').remove();prvCall.currentUid=-1;}};PrvCallGUI.prototype.showInvitation=function(fromMe,fromUid,fromUsername,toUid,toUsername,time,tokens,desc,timeLeft){if(fromMe){this.showBottomPopup(lang['upc-waiting']+' <span class="green">'+toUsername+'</span> <span class="grey">(<span class="time">--:--</span>)</span>');}else{var html='<div class="title">'+lang['upc-new-invitation']+'</div>';html+='<div class="desc">';html+='<span>'+lang['upc-inviter']+':</span> '+fromUsername+'<br/>';html+='<span>'+lang['upc-desc']+':</span> '+desc+'<br/>';html+='<span>'+lang['p-invi-time']+':</span> '+injectVariable(lang['upc-time'],[time])+'<br/>';html+='<span>'+lang['p-invi-price']+':</span> '+injectVariable(lang['upt-tokens2'],[tokens])+'<br/>';html+='</div>';html+='<div class="buttons"><a href="javascript:void(0)" onclick="prvCall.accept();" class="green">'+lang['upc-accept']+'</a> &nbsp;  &nbsp;  &nbsp; <a href="javascript:void(0)" onclick="prvCall.decline();" class="red">'+lang['upc-decline']+'</a></div>';this.showRightPopup(html);}};PrvCallGUI.prototype.showBottomPopup=function(html,timeToHide){this.hideBottomPopup();$('body').append(this.bottomPopup);$('.prv-call-bottom').html(html);if(timeToHide){var o=this;this.bottomPopupTimer=setTimeout(function(){o.hideBottomPopup();},timeToHide);}};PrvCallGUI.prototype.hideBottomPopup=function(){if(this.bottomPopupTimer!=null)
clearTimeout(this.bottomPopupTimer);if($('.prv-call-bottom').length!=0){$('.prv-call-bottom').remove();}};PrvCallGUI.prototype.showRightPopup=function(html){this.hideRightPopup();$('body').append(this.rightPopup);$('.prv-call-right').html(html);};PrvCallGUI.prototype.hideRightPopup=function(){if($('.prv-call-right').length!=0)
$('.prv-call-right').remove();};PrvCallGUI.prototype.updateTimer=function(newTime){$('.prv-call-bottom .time').html(newTime);};PrvCallGUI.prototype.showAcceptInvitation=function(uniq){var html='<div class="title">'+lang['upc-invi-accpeted']+'</div>';html+='<div class="buttons"><a href="javascript:void(0)" onclick="prvCall.enterPrv(\''+uniq+'\');" class="green">'+lang['upc-enter-prv']+'</a></div>';this.showRightPopup(html);};var prvCallGUI;$(function(){prvCallGUI=new PrvCallGUI();});function ChristmasCard(){addPackageListener(packetController.EVT_NEW_PACKAGE,G_CHRISTMAS_CARD_STATUS,this.status.bind(this));addPackageListener(packetController.EVT_NEW_PACKAGE,G_T_CHRISTMAS_CARD,this.putInChatInfo.bind(this));};ChristmasCard.prototype.send=function(tokens,toUid){packetController.sendArray(S_CHRISTMAS_CARD,new Array(toUid,tokens));};ChristmasCard.prototype.status=function(p){switch(p.msg[0]){case'yourSelf':christmasCardGUI.showAlert('error',lang['ch-not-urself'],3000);break;case'noUser':christmasCardGUI.showAlert('error',lang['upc-no-user'],3000);break;case'minTokensNotReached':christmasCardGUI.showAlert('error',lang['ch-min-tokens'],3000);break;case'tooLittleTokens':christmasCardGUI.showAlert('error',lang['tip-little-tokens'],3000);break;case'uHaveTrans':christmasCardGUI.showAlert('error',lang['ch-u-have-trans'],3000);break;default:christmasCardGUI.success(p.msg[0]);break;}};ChristmasCard.prototype.putInChatInfo=function(p){if(typeof transmissionGUI!="undefined"){transmissionGUI.msgCardInfo(p.msg[1],p.msg[2],p.msg[0]);}};function openChristmasCard(uniq){var newwindow=window.open(siteUrl+'/site/christmas_card/'+uniq,lang['ch-title'],'scrollbars=0,height=373,width=740');if(window.focus){newwindow.focus();}
return false;};var christmasCard;$(function(){christmasCard=new ChristmasCard();});function ChristmasCardGUI(){this.currentPos='';this.initTopOffset=-1;};ChristmasCardGUI.prototype.open=function(uid,username,obj,pos){this.close();this.currentPos=pos;var html='<div id="cards-popup" class="popup">';html+='<div class="popup-arrow"></div>';html+='<div class="cards-alerts"></div>';html+='<div class="send-card-content">';html+='<div class="title">'+lang['ch-card-for']+' '+username+'</div>';html+='<img src="'+siteUrl+'/images/samplecard.png" width"310" height="156"/>';html+='<div class="basic-form input">'+injectVariable(lang['ch-card-tokens-inp'],['<input type="text" style="width:25px" value="50"/>'])+'</div>';html+='<a class="generic-pink-btn confirm" href="javascript:void(0)">'+lang['ch-send']+'</a>';html+='<a class="gray-btn cancel" href="javascript:void(0)" style="float:right;">'+lang['upc-cancel']+'</a>';html+='</div>';$('body').append(html);var offset=$(obj).offset();this.initTopOffset=offset.top;$('#cards-popup').css('left',offset.left+'px');$('#cards-popup').css('width','310px');if(pos=='bottom'){$('#cards-popup').css('top',this.initTopOffset+'px');$('#cards-popup .popup-arrow').css('top',-13+'px').css('background','url(images/popup-arrow2.png)');}else{$('#cards-popup').css('top',(this.initTopOffset-$('#cards-popup').height()-40)+'px');}
var o=this;$('#cards-popup .confirm').click(function(){o.send(uid);});$('#cards-popup .cancel').click(function(){o.close();});};ChristmasCardGUI.prototype.send=function(toUid){var tokens=$('#cards-popup input').val();if(!user.isLogged){this.showAlert('error',lang['login-first'],3000);return;}
if(isNaN(tokens)){this.showAlert('error',lang['ch-tokens-num'],3000);return;}
if(tokens<50){this.showAlert('error',lang['ch-min-tokens'],5000);return;}
christmasCard.send(tokens,toUid);};ChristmasCardGUI.prototype.showAlert=function(type,msg,time){var o=this;this.clearAlerts();var obj=$('<div class="'+type+'-alert">'+msg+'</div>');$('#cards-popup .cards-alerts').append(obj);setTimeout(function(){$(obj).remove();if(o.currentPos=='top')$('#cards-popup').css('top',(o.initTopOffset-$('#cards-popup').height()-40)+'px');},time);if(this.currentPos=='top')$('#cards-popup').css('top',(this.initTopOffset-$('#cards-popup').height()-40)+'px');};ChristmasCardGUI.prototype.clearAlerts=function(type,msg,time){$('#cards-popup .cards-alerts').html('');if(this.currentPos=='top')$('#cards-popup').css('top',(this.initTopOffset-$('#cards-popup').height()-40)+'px');};ChristmasCardGUI.prototype.close=function(){$('#cards-popup').remove();};ChristmasCardGUI.prototype.close=function(){$('#cards-popup').remove();};ChristmasCardGUI.prototype.success=function(uniq){$('#cards-popup .send-card-content').html('<a class="gray-btn close-window" href="javascript:void(0)" style="float:right;">'+lang['close']+'</a>');var o=this;$('#cards-popup .close-window').click(function(){o.close();});this.showAlert('success',injectVariable(lang['ch-success'],['openChristmasCard("'+uniq+'")']),1800000);};var christmasCardGUI;$(function(){christmasCardGUI=new ChristmasCardGUI();});